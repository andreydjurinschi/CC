### Джуринский Андрей, I2302
### Лабораторная работа №3.

### Цель

Научиться вручную создавать виртуальную сеть (VPC) в AWS, добавлять в неё подсети, таблицы маршрутов, интернет-шлюз (IGW) и NAT Gateway, а также настраивать взаимодействие между веб-сервером в публичной подсети и сервером базы данных в приватной.

_________________

#### создание VPC 

VPC — это “контейнер” для подсетей. Внутри одной VPC можно создавать десятки подсетей с разными маршрутами и правилами.

![](/lab03/photos/Screenshot_1.png)

создаем свой VPC, устанавливаем `CIDR` запись для сети
____________________________

> Что обозначает маска /16? И почему нельзя использовать, например, /8?

данная маска обозначает: первые 16 бит - являются частью самой сети, остальные 16 это часть устройств внутри этой сети

`10.5` - это номер сети. `0.0` - `255.255` - диапазон устройств внутри нее

> устройства могут иметь адреса от 10.5.0.1 до 10.5.255.254
____________________________

> почему нельзя использовать /8

только первое число - номер сети, остальные три это части адресов

для сравнения: 

Количество адресов /16: 2^(32−16) = 65 536 адресов
Количество адресов /8: 2^(32−8) = 16 777 216 адресов

такая сеть тяжело обслуживается, адреса тратятся впустую,таблица маршрутов становится огромной
____________________________

#### создание Internet Gateway (IGW)

Internet Gateway позволяет ресурсам внутри VPC выходить в Интернет. Без него публичные IP-адреса не будут работать. Если вашей виртуальной машине (EC2) назначен публичный IP, но нет IGW, она не сможет общаться с внешним миром

![](/lab03/photos/Screenshot_2.png)

прикрепляем шлюз к нашей VPC

![](/lab03/photos/Screenshot_3.png)

вывод: 

без IGW если у нас просто создана VPC, все её ресурсы (инстансы, бд и т.д.)живут в изолированной сети, без доступа в интернет. Они могут общаться только между собой внутри этой сети

с IGW когда мы добавляем IGW и прикрепляем его к VPC, то фактически открываем этой сети выход в интернет

______________________________

#### создание подсетей

Подсети (subnets) — это сегменты внутри VPC, которые позволяют изолировать ресурсы. То есть, подсети создаются для разделения ресурсов по функционалу и уровню доступа и для более гибкого управления трафиком

![](/lab03/photos/Screenshot_4.png)

ууказали название, зону доступности, диапазон IP адресов (первые три числа относятся к сети, остальные для устройств)

> Является ли подсеть "публичной" на данный момент? Почему?

нет, не является, тк не хватает настройки таблицы маршрутов

______________________________

#### создание приватной подсети

![](/lab03/photos/Screenshot_5.png)

ууказали название, зону доступности, диапазон IP адресов (первые три числа относятся к сети, остальные для устройств)

подсети в одной VPC не должны иметь одинаковые или пересекающиеся диапазоны IP, иначе AWS не сможет понять,
в какую подсеть направлять трафик.

> Является ли подсеть приватной сейчас?

пока нет — она просто новая изолированная подсеть. Она станет приватной, если нет маршрута к Internet Gateway

![](/lab03/photos/Screenshot_6.png)

______________________________

#### Создание публичной таблицы маршрутов

создание таблицы

![](/lab03/photos/Screenshot_7.png)

создание маршрута

![](/lab03/photos/Screenshot_8.png)

привязка таблицы к подсети

![](/lab03/photos/Screenshot_9.png)

Теперь трафик из публичной подсети (например, от веб-сервера или NAT Gateway) будет отправляться наружу через Internet Gateway. Связь “0.0.0.0/0 → IGW” — именно то, что делает подсеть публичной.

> Что делает таблица маршрутов (Route Table)

это как карта дорог внутри сети, если пакет не знает, куда идти, он заглядывает в таблицу маршрутов и находит направление

сама по себе подсеть ничего не знает — ни о других подсетях, ни о выходе в интернет;

только через таблицу маршрутов она узнаёт, как добраться:
- до других подсетей внутри VPC,
- до интернета (через IGW),
- до NAT Gateway (для приватных подсетей)

______________________________

#### Создание приватной таблицы маршрутов

![](/lab03/photos/Screenshot_10.png)

На данный момент все ресурсы, которые будут созданы в приватной подсети, не смогут выходить в Интернет, так как у нас нет NAT Gateway и соответствующего маршрута.

______________________________

#### Создание NAT Gateway

> Как работает NAT Gateway?

NAT (Network Address Translation) Gateway — это специальный сервис AWS, который позволяет ресурсам в приватной подсети выходить в интернет,
но не позволяет интернету подключаться к ним обратнo

Внешний мир не видит приватные адреса (10.x.x.x).
Он видит только один публичный IP NAT Gateway. Поэтому:
приватные инстансы могут скачивать пакеты, обновления и обращаться к API,
но интернет не может подключиться к ним напрямую.

______________________________

#### Создание Elastic IP

Elastic IP — это статический публичный IPv4-адрес, закреплённый за вашим аккаунтом AWS. Он используется для NAT Gateway, чтобы тот мог представлять собой “точку выхода” в Интернет от имени всех приватных инстансов

![](/lab03/photos/Screenshot_11.png)

______________________________

#### Создание NAT

![](/lab03/photos/Screenshot_12.png)

![](/lab03/photos/Screenshot_13.png)

Теперь ресурсы в приватной подсети смогут выходить в Интернет через NAT Gateway

______________________________

#### Создание Security Groups

Security Group (SG) — это виртуальный брандмауэр на уровне инстанса (EC2), который контролирует входящий (Inbound) и исходящий (Outbound) трафик.

1) Security group for web server

![](/lab03/photos/Screenshot_14.png)

0.0.0.0/0 — это все IPv4-адреса в мире .
Порты 80 и 443 — стандартные порты для веб-трафика.
Протокол TCP — потому что HTTP и HTTPS используют именно TCP.

###### bastion-sg-kXX для bastion host с разрешением входящего трафика на порт 22 (SSH) только из вашего IP-адреса.

![](/lab03/photos/Screenshot_15.png)


###### db-sg-kXX для базы данных с разрешением входящего трафика

![](/lab03/photos/Screenshot_16.png)

> Что такое Bastion Host и зачем он нужен в архитектуре с приватными подсетями?

Bastion Host — это специальный сервер, который служит «мостом» между интернетом и приватными подсетями.

В архитектуре с приватными подсетями:
- EC2 в приватной подсети не имеют прямого доступа из интернета (нет публичного IP).
- Если нужно подключиться к этим серверам (например, по SSH) — прямой доступ невозможен.

`Bastion Host решает эту проблему:`
- Он находится в публичной подсети и имеет публичный IP
- мы подключаемся к нему с  локального компьютера
- Через Bastion Host можно достучаться до приватных инстансов (SSH или RDP)

______________________________

#### Создание EC2-инстансов

![](/lab03/photos/Screenshot_17.png)


![](/lab03/photos/Screenshot_18.png)




