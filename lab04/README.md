## Лабораторная работа №4. Облачное хранилище данных. Amazon S3

![](/lab04/photos/Screenshot_1.png)

_____________________

1) создаем структуру каталогов и файлов

```
PS C:\Users\Calculator\CC\lab04> tree
Структура папок тома System
Серийный номер тома: 504C-FB5F
C:.
├───photos
├───private
│   └───logs
└───public
    ├───avatars
    └───content
```

2) создаем бакеты 

________

> Чем отличаются два способа управления доступом к бакетам в S3? (ACL, Object Ownership)

ACL - является устаревшим методом управления доступом. Позволяет настраивать разрешения для отдельных объектов и бакетов через списки контроля доступа. Имеет ограничения и менее гибкий в настройке.

Object Ownership - современный способ. Предоставляет более простое и безопасное управление доступом на уровне бакета. Позволяет автоматически отключать ACL и управлять доступом только через политики (bucket policies и IAM policies).
________

### Создание бакетов без ACL

1. создаем публичный бакет

![](/lab04/photos/Screenshot_2.png)

2. создаем приватный бакет

![](/lab04/photos/Screenshot_3.png)

Управление доступом выполняется через IAM и Bucket Policy.

3. создание IAM-пользователя и выдача прав


![](/lab04/photos/Screenshot_4.png)

3. создание политики

```json
{
    "Version": "2012-10-17",
  "Statement": [
      {
          "Sid": "ListOnlyTheseBuckets",
      "Effect": "Allow",
      "Action": ["s3:ListBucket"],
      "Resource": [
          "arn:aws:s3:::cc-lab4-pub-k05",
        "arn:aws:s3:::cc-lab4-priv-k05"
      ]
    },
    {
        "Sid": "ReadWritePublicBucketLimited",
      "Effect": "Allow",
      "Action": ["s3:GetObject", "s3:PutObject", "s3:DeleteObject"],
      "Resource": "arn:aws:s3:::cc-lab4-pub-k05/*"
    },
    {
        "Sid": "LogsRWButOnlyUnderLogsPrefix",
      "Effect": "Allow",
      "Action": ["s3:GetObject", "s3:PutObject", "s3:DeleteObject"],
      "Resource": "arn:aws:s3:::cc-lab4-priv-k05/logs/*"
    }
  ]
}
```
Version: Указывает версию языка политики. В данном случае используется версия от 2012-10-17, которая является актуальной.

Statement: Основной блок, содержащий массив утверждений (statements), каждая из которых описывает конкретные разрешения.

Первое утверждение:

- Sid: Уникальный идентификатор для этого утверждения.
- Effect: Указывает, что действие разрешено (Allow).
- Action: Разрешает действие s3:ListBucket, что позволяет перечислять указанные бакеты.
- Resource: Указывает, что разрешение применяется только к двум бакетам: cc-lab4-pub-k05 и cc-lab4-priv-k05.

Второе утверждение:
- Sid: Уникальный идентификатор.
- Effect: Разрешает действия (Allow).
- Action: Разрешает действия s3:GetObject, s3:PutObject, и s3:DeleteObject, что позволяет читать, записывать и удалять объекты.
- Resource: Применяется ко всем объектам в публичном бакете cc-lab4-pub-k05.

Третье утверждение:
- Sid: Уникальный идентификатор.
- Effect: Разрешает действия (Allow).
- Action: Разрешает те же действия, что и во втором утверждении.
- Resource: Применяется только к объектам в папке logs внутри приватного бакета cc-lab4-priv-k05.

Зачем нужны эти политики?
- Безопасность: Политики IAM помогают ограничить доступ к ресурсам, предоставляя только необходимые разрешения. Это минимизирует риски несанкционированного доступа.
- Управление доступом: Позволяют управлять тем, кто и какие действия может выполнять с ресурсами S3, что особенно важно в больших командах или организациях.
- Аудит и соответствие: Политики позволяют отслеживать и контролировать доступ к ресурсам, что важно для соблюдения стандартов безопасности и аудита.
- Эта политика позволяет пользователям или сервисам безопасно взаимодействовать с определенными бакетами S3, обеспечивая при этом контроль над действиями, которые они могут выполнять.

![](/lab04/photos/Screenshot_5.png)

4.  Разрешение чтения из публичного бакета

![](/lab04/photos/Screenshot_6.png)


![](/lab04/photos/Screenshot_7.png)



> Чем отличается ключ (object key) от имени файла?

Ключ (object key) в S3 - это уникальный идентификатор объекта в бакете, который включает путь к объекту и его имя. Имя файла - это просто название файла на локальной файловой системе. В S3 ключи используются для организации и доступа к объектам, в то время как имя файла может быть лишь частью ключа

5. Загрузка объектов через AWS CLI

```bash
C:\Users\Calculator>aws --version
aws-cli/2.31.32 Python/3.13.9 Windows/11 exe/AMD64

C:\Users\Calculator>aws configure
AWS Access Key ID [None]: ****
AWS Secret Access Key [None]: ******
Default region name [None]: eu-central-1
Default output format [None]: json


C:\Users\Calculator\CC\lab04>aws s3 cp public/avatars/user2.jpg s3://cc-lab4-pub-k05/avatars/user2.jpg
upload: public\avatars\user2.jpg to s3://cc-lab4-pub-k05/avatars/user2.jpg

C:\Users\Calculator\CC\lab04>aws s3 cp public/content/logo.png s3://cc-lab4-pub-k05/content/logo.png
upload: public\content\logo.png to s3://cc-lab4-pub-k05/content/logo.png

C:\Users\Calculator\CC\lab04>aws s3 cp private/logs/activity.csv s3://cc-lab4-priv-k05/logs/activity.csv
upload: private\logs\activity.csv to s3://cc-lab4-priv-k05/logs/activity.csv
```

В режиме «Bucket owner enforced» нельзя использовать ACL, поэтому флаг --acl public-read вызывает ошибку

> В чём разница между командами aws s3 cp, mv и sync и для чего используется параметр флаг --acl public-read?

Команды AWS CLI для работы с S3:
- `aws s3 cp` - копирует файлы между локальной системой и S3 или между бакетами S3
- `aws s3 mv` - перемещает файлы (копирует и удаляет оригинал)
- `aws s3 sync` - синхронизирует целые директории, копируя только изменённые или новые файлы

Флаг `--acl public-read` устанавливает публичные права на чтение для загружаемых объектов. Это позволяет любому пользователю читать объект без аутентификации. Используется только когда включены ACL для бакета.

![](/lab04/photos/Screenshot_8.png)

![](/lab04/photos/Screenshot_9.png)

6. версионирование

> Что произойдёт, если выключить версионирование после его включения?

- Состояние станет "Suspended" (приостановлено). Это не удаляет уже существующие версии — все версии и delete‑марки остаются в бакете.
- Новые загрузки после приостановки больше не получают уникальные VersionId — объекты будут иметь null‑версию (S3 перестаёт присваивать версии).

7. Создание Lifecycle-правил для приватного бакета

![](/lab04/photos/Screenshot_10.png)

Правила lifecycle для бакетов S3 нужны для автоматизации управления жизненным циклом объектов: экономия затрат, поддержание соответствия и автоматическая очистка

> Что такое Storage Class в Amazon S3 и зачем они нужны?

Storage Class в Amazon S3 — это метаданные объекта, которые определяют его поведение по отношению к стоимости хранения, доступности и времени восстановления. Проще говоря, класс хранения выбирает, как и за сколько AWS будет хранить данные: высокодоступно и дорого, экономно с редким доступом или архивно с длительным временем извлечения.



